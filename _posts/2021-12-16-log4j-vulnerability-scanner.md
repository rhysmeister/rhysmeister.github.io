---
layout: post
title: log4j vulnerability scanner
date: 2021-12-16 13:07:00.000000000 +01:00
type: post
published: true
status: publish
categories:
  - log4j
  - linux
  - golang
tags:
  - log4j
  - linux
  - golang
---
** WARNING: As with any tool you download from the Internet...**
* Check the source code.
* Don't run as root or other high-privileged user.
* Run only in a test system and never in prod.
* Keep out of reach of Children.

Here's some quick notes about using a tool I discovered to check for the recent [log4j](https://logging.apache.org/log4j/2.x/) security vulnerability (otherwise known as [CVE-2021-45046](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-45046)).

Firstly you'll need to install golang, clone the [local-log4j-vuln-scanner](https://github.com/hillu/local-log4j-vuln-scanner) and build the code.

{% highlight bash %}
sudo yum install golang
git clone https://github.com/hillu/local-log4j-vuln-scanner.git
cd local-log4j-vuln-scanner
go build -o local-log4j-vuln-scanner ./scanner
{% endhighlight %}

There's also a "patcher", although I'm not sure I'd touch that atzm...

{% highlight bash %}
go build -o local-log4j-vuln-patcher ./patcher - I probably wouldn't do this!
{% endhighlight %}

Then, once you've fired up a disposal test environment in your favourite cloud, you can run the tool against your instances. I'm using [Ansible](https://docs.ansible.com/ansible/latest/index.html) to make that easy...

# Copy scanner to host

{% highlight bash %}
ansible all -m copy -a "src=local-log4j-vuln-scanner dest=/tmp/local-log4j-vuln-scanner mode=0300" -i inventory.yml -b -u ec2-user --private-key /home/ec2-user/.ssh/mysecretkey.pem
{% endhighlight %}

# Execute scanner on host

We'll scan just the /user and /opt directories here. Any others can be appended to the command

{% highlight bash %}
ansible all -m shell -a "/tmp/local-log4j-vuln-scanner /usr /opt" -i inventory.yml -b -u ec2-user --private-key /home/ec2-user/.ssh/mysecretkey.pem
{% endhighlight %}

# Clean up

{% highlight bash %}
ansible all -m file -a "path=/tmp/local-log4j-vuln-scanner state=absent" -i inventory.yml -b -u ec2-user --private-key /home/ec2-user/.ssh/mysecretkey.pem
{% endhighlight %}